<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Bot Manager</title>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; color: #1c1e21; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; text-align: center; }
        .container { max-width: 800px; width: 90%; padding: 24px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1, h2 { border-bottom: 1px solid #dddfe2; padding-bottom: 15px; }
        #status-box { padding: 12px; margin-bottom: 20px; border-radius: 6px; background-color: #e7f3ff; color: #1877f2; font-weight: bold; }
        #qr-container img { max-width: 320px; width: 100%; height: auto; margin-top: 15px; border: 1px solid #dddfe2; padding: 8px; border-radius: 8px;}
        .hidden { display: none; }
        /* Add other styles for form and keyword list */
        .form-container { display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 25px; text-align: left;}
        .form-container input, .form-container select, .form-container button { width: 100%; padding: 12px; border: 1px solid #ccd0d5; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
        .keyword-item { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; border-bottom: 1px solid #dddfe2; align-items: center; text-align: left; }
        .keyword-item .actions { grid-column: 1 / -1; display: flex; gap: 10px; justify-content: flex-end; }
    </style>
</head>
<body>
    <div class="container">
        <h1>WhatsApp Bot Manager</h1>
        <div id="status-box">Connecting to server...</div>

        <!-- This section will show the QR Code -->
        <div id="qr-container">
            <p>Please wait for the QR code to appear...</p>
            <img id="qrcode-image" class="hidden" src="" alt="Scan this QR Code">
        </div>

        <!-- This section will show after successful login -->
        <div id="keywords-manager" class="hidden">
            <!-- Keyword management form and list will be here -->
        </div>
    </div>

    <!-- This must be here to connect to the backend -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();

            const statusBox = document.getElementById('status-box');
            const qrContainer = document.getElementById('qr-container');
            const qrcodeImage = document.getElementById('qrcode-image');
            const keywordsManager = document.getElementById('keywords-manager');

            // Listen for messages from the server
            socket.on('message', (msg) => {
                statusBox.textContent = msg;
            });

            // Listen for the 'qr' event from the server
            socket.on('qr', (url) => {
                qrcodeImage.src = url; // Set the image source to the QR code data
                qrcodeImage.classList.remove('hidden');
                keywordsManager.classList.add('hidden'); // Hide manager
            });

            // Listen for the 'ready' event
            socket.on('ready', () => {
                statusBox.textContent = 'WhatsApp is connected! You can manage keywords now.';
                qrContainer.classList.add('hidden'); // Hide QR container
                loadKeywordsManager(); // Load the keywords section
            });

            // Listen for disconnection
            socket.on('disconnected', () => {
                statusBox.textContent = 'Client Disconnected. Please refresh the page to reconnect.';
                keywordsManager.classList.add('hidden');
                qrContainer.classList.remove('hidden');
            });
            
            function loadKeywordsManager() {
                keywordsManager.classList.remove('hidden');
                // You can add your keyword management html and logic here
                keywordsManager.innerHTML = `
                    <h2>Keyword Manager</h2>
                    <p>Add, edit, or remove keywords for auto-reply.</p>
                    <!-- Your form and list HTML would go here -->
                `;
            }
        });
    </script>
</body>
</html>
